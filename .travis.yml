sudo: required

services:
  - docker
  - postgresql

notifications:
  email:
    recipients:
      - shawnhmh@gmail.com
  on_success: change
  on_failure: always

language: python
python:
  - '3.6'

install: true

before_install:
  - nvm install v8
  - pip install pipenv
  - pipenv --python 3.6
  - pipenv install -r server/requirements/prod.txt

env:
  PIPENV_VERBOSITY: -1
  SECRET_KEY: keepitsecret
  DJANGO_SETTINGS_MODULE: spare.settings.prod
  DATABASE_URL: postgres://postgres:postgres_pass@localhost:5432/postgres_db

before_script:
  - psql -c 'create database postgres_db;' -U postgres

script:
  - pip install pipenv
  - pipenv --python 3.6
  - pipenv install -r server/requirements/prod.txt
  - cd server && sh scripts/run_tests.sh
  - cd ../client/
  - pwd
  - ls /home/travis/build/hackforla/spare/client
  - ls /home/travis/build/hackforla/spare/client/src
  - npm install
  - npm rebuild node-sass
  - npm run build-js
  - npm run build-css

after_success:
  - echo "Successful!"
